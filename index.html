<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI HUB Photobooth</title>

  <!-- Google Identity Services + Client ID (für Drive OAuth) -->
  <meta name="google-signin-client_id"
        content="73722312940-8vrnm5jcgkmoqonbv9pa3m8j37dttmfh.apps.googleusercontent.com" />
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <!-- Styles -->
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header>
    <h1>AI HUB Photobooth</h1>
  </header>

  <section id="screenPreview" class="screen active">
    <div class="card stage">
      <video id="video" playsinline autoplay muted></video>
      <div class="overlay">
        <div id="count" class="count">5</div>
      </div>
    </div>
    <div class="bigbar">
      <button id="shootBtn" class="primary">📸 Foto machen</button>
    </div>
  </section>

  <section id="screenCaptured" class="screen">
    <div class="card stage"><canvas id="canvas"></canvas></div>
    <div class="bigbar">
      <button id="continueBtn" class="primary">✅ Mit Bild fortfahren</button>
      <button id="retryBtn" class="secondary">🔁 Nochmal versuchen</button>
    </div>
  </section>

  <section id="screenStyle" class="screen">
    <div class="style-wrap">
      <h2 style="margin:0;font-size:1.2rem">🎨 Foto Stil wählen</h2>
      <div id="reuseNote" class="help" style="display:none">↻ Gleiches Foto wird wiederverwendet. Wähle einfach einen neuen Stil.</div>
      <div class="grid" id="styleGrid"></div>
      <div>
        <label for="customStyle" style="display:block;margin-bottom:6px;color:var(--muted)">Anderen Stil beschreiben:</label>
        <textarea id="customStyle" class="textarea" placeholder="z.B. Aquarell, Low-Poly, Cyberpunk Neon…"></textarea>
      </div>
      <div class="bigbar" style="padding-bottom:0">
        <button id="startGenBtn" class="primary">🧠 KI‑Generierung starten</button>
      </div>
    </div>
  </section>

  <section id="screenGenerate" class="screen">
    <div class="gen-wrap">
      <h2 style="margin:0;font-size:1.2rem">✨ Magie an der Arbeit</h2>
      <div class="gen-grid">
        <div class="gen-item">
          <header>Prompt</header>
          <div class="content" style="padding:12px">
            <textarea id="promptOut" class="textarea" style="min-height:50vh;font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace"></textarea>
          </div>
        </div>
        <div class="gen-item">
          <header></header>
          <div class="content" id="resultBox">
            <div class="progress"><span class="hourglass">⏳</span> Die Bilderstellung läuft… das kann ca. 1 Minute dauern.</div>
          </div>
        </div>
      </div>
    </div>
    <div class="bigbar"></div>
  </section>

  <section id="screenResult" class="screen">
    <div class="result-img"><img id="finalImg" alt="Generiertes Bild (3:2 mit Wasserzeichen)"></div>
    <div class="bigbar">
      <button id="printBtn" class="primary">🖨️ Bild drucken</button>
      <button id="shareBtn" class="secondary" style="outline:3px solid rgba(16,185,129,.35)">🌿 Bild teilen (Drive + QR)</button>
      <!-- Gmail vorerst deaktiviert
      <button id="gmailBtn" class="secondary">✉️ Per Gmail senden</button> -->
      <button id="restyleBtn" class="secondary">✨ Mit gleichem Foto neu stylen</button>
      <button id="restartBigBtn" class="secondary">🔄 Neu starten</button>
    </div>
  </section>

  <button id="restartFab" class="corner-btn" title="Neu starten">🔄</button>
  <button id="settingsFab" class="corner-btn" title="Einstellungen">⚙️</button>

  <div id="settings" class="modal">
    <div class="box">
      <header style="display:flex;align-items:center;justify-content:space-between">
        <h2 style="margin:0">⚙️ Einstellungen</h2>
        <button id="closeSettings" class="secondary" style="border-radius:10px">Schließen</button>
      </header>
      <div class="row">
        <label for="cameraSel">Kamera</label><select id="cameraSel" class="select"></select>
      </div>
      <div class="row">
        <label for="apiKey">OpenAI API Key</label><input id="apiKey" class="input" type="password" placeholder="sk-… (Session)">
      </div>
      <hr style="border:none;border-top:1px solid var(--border);margin:10px 0">
      <div class="row">
        <div>
          <strong>Google Drive</strong>
          <div class="help">Verbinden (OAuth wird nicht automatisch bei Reload geöffnet)</div>
        </div>
        <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
          <button id="driveConnect" class="secondary">Mit Google verbinden</button>
          <span id="driveStatus" class="help">Nicht verbunden</span>
        </div>
      </div>
      <div class="row">
        <div class="help">Version</div>
        <div id="versionText" class="help"></div>
      </div>
      <div class="row">
        <label for="logoFile">Logo (PNG/JPG/SVG)</label>
        <div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap">
          <input id="logoFile" type="file" accept="image/png,image/svg+xml,image/jpeg" class="input" />
          <img id="logoPreview" alt="Logo-Vorschau" style="height:36px;max-width:160px;object-fit:contain;border:1px solid var(--border);border-radius:6px;padding:3px;background:#fff" />
          <button id="logoClear" class="secondary" type="button">Entfernen</button>
        </div>
      </div>
    </div>
  </div>

  <div id="onboard" class="onboard">
    <div class="box">
      <header style="display:flex;align-items:center;justify-content:space-between">
        <h2 style="margin:0">Willkommen! Kurz einrichten ✨</h2>
      </header>
      <div class="steps">
        <div class="step">
          <h3>1) Kamera wählen</h3><select id="obCamera" class="select"></select><button id="obGrantCam" class="secondary">Zugriff erlauben & Vorschau testen</button>
        </div>
        <div class="step">
          <h3>2) OpenAI Key</h3><input id="obApiKey" class="input" type="password" placeholder="sk-…">
        </div>
        <div class="step">
          <h3>3) Drive verbinden</h3>
          <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center"><button id="obDriveConnect" class="secondary">Mit Google verbinden</button></div>
          <div id="obDriveStatus" class="help">Nicht verbunden</div>
        </div>
      </div>
      <div id="obMissing" class="help" style="white-space:pre-line;color:#dc2626"></div>
      <div style="display:flex;gap:8px;justify-content:flex-end"><button id="obDone" class="primary">Fertig</button></div>
    </div>
  </div>

  <div id="qrModal" class="qr">
    <div class="box">
      <div style="font-weight:800;color:#065f46;background:#d1fae5;border:1px solid #10b981;padding:.4rem .7rem;border-radius:999px">
        🌿 Umweltfreundlich: Digital teilen statt drucken
      </div>
      <div id="qrBox"></div>
      <div id="qrLink"></div>
      <button id="qrClose" class="secondary">Schließen</button>
    </div>
  </div>

  <div id="flash" class="flash"></div>

  <!-- App -->
  <script src="app.js" defer></script>
</body>
</html>
